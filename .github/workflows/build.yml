name: Build Praxiom Health App

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ— Setup repo
        uses: actions/checkout@v4

      - name: ğŸ— Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18.x

      - name: ğŸ“¦ Install dependencies
        run: npm install

      - name: ğŸ”‘ Check EAS Credentials (Diagnostic)
        run: |
          echo "ğŸ” Checking Expo project configuration..."
          echo "Project ID: $(cat app.json | grep projectId | cut -d'"' -f4)"
          echo "Package: $(cat app.json | grep '\"package\"' | cut -d'"' -f4)"
          echo ""
          echo "ğŸ“‹ EAS Configuration:"
          cat eas.json | grep -A 5 "android"
        continue-on-error: true

      - name: ğŸš€ Build app
        run: eas build --platform android --profile preview --non-interactive
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Upload artifact
        uses: actions/upload-artifact@v4
        if: success()
        with:
          name: praxiom-health-apk
          path: '*.apk'
