name: Build and Deploy Praxiom Health App

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ”§ Setup Expo and EAS
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Install dependencies
        run: npm install --legacy-peer-deps

      - name: ğŸ”‘ Initialize EAS Project
        run: eas init --id ${{ secrets.EXPO_PROJECT_ID }} --non-interactive
        continue-on-error: true

      # ============================================
      # iOS BUILD AND SUBMIT TO APP STORE CONNECT
      # ============================================
      
      - name: ğŸ Build iOS App
        run: eas build --platform ios --profile production --non-interactive
        
      - name: ğŸš€ Submit iOS to App Store Connect
        run: eas submit --platform ios --latest --non-interactive
        continue-on-error: true  # Don't fail if submit has issues
        
      # ============================================
      # ANDROID BUILD
      # ============================================
      
      - name: ğŸ¤– Build Android APK
        run: eas build --platform android --profile preview --non-interactive

      # ============================================
      # NOTIFICATIONS (OPTIONAL)
      # ============================================
      
      - name: âœ… Notify Success
        if: success()
        run: |
          echo "âœ… Build completed successfully!"
          echo "ğŸ“± iOS app submitted to App Store Connect"
          echo "ğŸ¤– Android APK built"
          
      - name: âŒ Notify Failure
        if: failure()
        run: |
          echo "âŒ Build failed. Check logs above."
